module.exports=[88041,30385,37137,a=>{"use strict";let b=Symbol.for("__cloudflare-context__");function c(){return globalThis[b]}async function d(){let a=c();if(a)return a;{var d;let a=await e();return d=a,globalThis[b]=d,a}}async function e(a){let{getPlatformProxy:b}=await import(`${"__wrangler".replaceAll("_","")}`),c=a?.environment??process.env.NEXT_DEV_WRANGLER_ENV,{env:d,cf:e,ctx:f}=await b({...a,envFiles:[],environment:c});return{env:d,cf:e,ctx:f}}var f=a.i(63227);class g{static [f.entityKind]="ConsoleLogWriter";write(a){console.log(a)}}class h{static [f.entityKind]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new g}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class i{static [f.entityKind]="NoopLogger";logQuery(){}}var j=a.i(20713),k=a.i(94415),l=j,m=a.i(44551),n=a.i(5302),o=n;class p extends o.PgColumnBuilder{static [f.entityKind]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class q extends p{static [f.entityKind]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new r(a,this.config)}}class r extends n.PgColumn{static [f.entityKind]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class s extends p{static [f.entityKind]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new t(a,this.config)}}class t extends n.PgColumn{static [f.entityKind]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}var u=n;class v extends u.PgColumnBuilder{static [f.entityKind]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new w(a,this.config)}}class w extends u.PgColumn{static [f.entityKind]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class x extends u.PgColumnBuilder{static [f.entityKind]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new y(a,this.config)}}class y extends u.PgColumn{static [f.entityKind]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}var z=n;class A extends z.PgColumnBuilder{static [f.entityKind]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new B(a,this.config)}}class B extends z.PgColumn{static [f.entityKind]="PgBoolean";getSQLType(){return"boolean"}}var C=n;class D extends C.PgColumnBuilder{static [f.entityKind]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new E(a,this.config)}}class E extends C.PgColumn{static [f.entityKind]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}var F=n;class G extends F.PgColumnBuilder{static [f.entityKind]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new H(a,this.config)}}class H extends F.PgColumn{static [f.entityKind]="PgCidr";getSQLType(){return"cidr"}}var I=n;class J extends I.PgColumnBuilder{static [f.entityKind]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new K(a,this.config)}}class K extends I.PgColumn{static [f.entityKind]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}var L=n,M=a.i(51674),N=n;class O extends N.PgColumnBuilder{static [f.entityKind]="PgDateColumnBaseBuilder";defaultNow(){return this.default(M.sql`now()`)}}class P extends O{static [f.entityKind]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new Q(a,this.config)}}class Q extends L.PgColumn{static [f.entityKind]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?new Date(a):a}mapToDriverValue(a){return a.toISOString()}}class R extends O{static [f.entityKind]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new S(a,this.config)}}class S extends L.PgColumn{static [f.entityKind]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?a:a.toISOString().slice(0,-14)}}var T=n;class U extends T.PgColumnBuilder{static [f.entityKind]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new V(a,this.config)}}class V extends T.PgColumn{static [f.entityKind]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}var W=n;class X extends W.PgColumnBuilder{static [f.entityKind]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new Y(a,this.config)}}class Y extends W.PgColumn{static [f.entityKind]="PgInet";getSQLType(){return"inet"}}var Z=n;class $ extends p{static [f.entityKind]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new _(a,this.config)}}class _ extends Z.PgColumn{static [f.entityKind]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}var aa=n;class ab extends aa.PgColumnBuilder{static [f.entityKind]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new ac(a,this.config)}}class ac extends aa.PgColumn{static [f.entityKind]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}var ad=n;class ae extends ad.PgColumnBuilder{static [f.entityKind]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new af(a,this.config)}}class af extends ad.PgColumn{static [f.entityKind]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}var ag=n;class ah extends ag.PgColumnBuilder{static [f.entityKind]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new ai(a,this.config)}}class ai extends ag.PgColumn{static [f.entityKind]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}var aj=n;class ak extends aj.PgColumnBuilder{static [f.entityKind]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new al(a,this.config)}}class al extends aj.PgColumn{static [f.entityKind]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class am extends aj.PgColumnBuilder{static [f.entityKind]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new an(a,this.config)}}class an extends aj.PgColumn{static [f.entityKind]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}var ao=n;class ap extends ao.PgColumnBuilder{static [f.entityKind]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new aq(a,this.config)}}class aq extends ao.PgColumn{static [f.entityKind]="PgMacaddr";getSQLType(){return"macaddr"}}var ar=n;class as extends ar.PgColumnBuilder{static [f.entityKind]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new at(a,this.config)}}class at extends ar.PgColumn{static [f.entityKind]="PgMacaddr8";getSQLType(){return"macaddr8"}}var au=n;class av extends au.PgColumnBuilder{static [f.entityKind]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new aw(a,this.config)}}class aw extends au.PgColumn{static [f.entityKind]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class ax extends au.PgColumnBuilder{static [f.entityKind]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new ay(a,this.config)}}class ay extends au.PgColumn{static [f.entityKind]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class az extends au.PgColumnBuilder{static [f.entityKind]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new aA(a,this.config)}}class aA extends au.PgColumn{static [f.entityKind]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}var aB=n;class aC extends aB.PgColumnBuilder{static [f.entityKind]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new aD(a,this.config)}}class aD extends aB.PgColumn{static [f.entityKind]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class aE extends aB.PgColumnBuilder{static [f.entityKind]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new aF(a,this.config)}}class aF extends aB.PgColumn{static [f.entityKind]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}var aG=n;function aH(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function aI(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=aH(b,c),d=aH(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class aJ extends aG.PgColumnBuilder{static [f.entityKind]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new aK(a,this.config)}}class aK extends aG.PgColumn{static [f.entityKind]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return aI(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class aL extends aG.PgColumnBuilder{static [f.entityKind]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new aM(a,this.config)}}class aM extends aG.PgColumn{static [f.entityKind]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=aI(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}var aN=n;class aO extends aN.PgColumnBuilder{static [f.entityKind]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new aP(a,this.config)}}class aP extends aN.PgColumn{static [f.entityKind]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}var aQ=n;class aR extends aQ.PgColumnBuilder{static [f.entityKind]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new aS(a,this.config)}}class aS extends aQ.PgColumn{static [f.entityKind]="PgSerial";getSQLType(){return"serial"}}var aT=n;class aU extends p{static [f.entityKind]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new aV(a,this.config)}}class aV extends aT.PgColumn{static [f.entityKind]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}var aW=n;class aX extends aW.PgColumnBuilder{static [f.entityKind]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new aY(a,this.config)}}class aY extends aW.PgColumn{static [f.entityKind]="PgSmallSerial";getSQLType(){return"smallserial"}}var aZ=n;class a$ extends aZ.PgColumnBuilder{static [f.entityKind]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new a_(a,this.config)}}class a_ extends aZ.PgColumn{static [f.entityKind]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}var a0=n;class a1 extends O{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [f.entityKind]="PgTimeBuilder";build(a){return new a2(a,this.config)}}class a2 extends a0.PgColumn{static [f.entityKind]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}var a3=n;class a4 extends O{static [f.entityKind]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new a5(a,this.config)}}class a5 extends a3.PgColumn{static [f.entityKind]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){return"string"==typeof a?new Date(this.withTimezone?a:a+"+0000"):a}mapToDriverValue=a=>a.toISOString()}class a6 extends O{static [f.entityKind]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new a7(a,this.config)}}class a7 extends a3.PgColumn{static [f.entityKind]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){if("string"==typeof a)return a;let b=a.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let c=a.getTimezoneOffset();return`${b}${c<=0?"+":"-"}${Math.floor(Math.abs(c)/60).toString().padStart(2,"0")}`}return b}}var a8=n;class a9 extends a8.PgColumnBuilder{static [f.entityKind]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default(M.sql`gen_random_uuid()`)}build(a){return new ba(a,this.config)}}class ba extends a8.PgColumn{static [f.entityKind]="PgUUID";getSQLType(){return"uuid"}}var bb=n;class bc extends bb.PgColumnBuilder{static [f.entityKind]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new bd(a,this.config)}}class bd extends bb.PgColumn{static [f.entityKind]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}var be=n;class bf extends be.PgColumnBuilder{static [f.entityKind]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new bg(a,this.config)}}class bg extends be.PgColumn{static [f.entityKind]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}var bh=n;class bi extends bh.PgColumnBuilder{static [f.entityKind]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new bj(a,this.config)}}class bj extends bh.PgColumn{static [f.entityKind]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}var bk=n;class bl extends bk.PgColumnBuilder{static [f.entityKind]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new bm(a,this.config)}}class bm extends bk.PgColumn{static [f.entityKind]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}var bn=n;class bo extends bn.PgColumnBuilder{static [f.entityKind]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new bp(a,this.config)}}class bp extends bn.PgColumn{static [f.entityKind]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}let bq=Symbol.for("drizzle:PgInlineForeignKeys"),br=Symbol.for("drizzle:EnableRLS");class bs extends l.Table{static [f.entityKind]="PgTable";static Symbol=Object.assign({},l.Table.Symbol,{InlineForeignKeys:bq,EnableRLS:br});[bq]=[];[br]=!1;[l.Table.Symbol.ExtraConfigBuilder]=void 0;[l.Table.Symbol.ExtraConfigColumns]={}}class bt{static [f.entityKind]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new bu(a,this.columns,this.name)}}class bu{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [f.entityKind]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[bs.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}var bv=a.i(93321);function bw(a){return M.sql`${a} asc`}function bx(a){return M.sql`${a} desc`}a.s(["asc",()=>bw,"desc",()=>bx],30385);class by{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[j.Table.Symbol.Name]}static [f.entityKind]="Relation";referencedTableName;fieldName}class bz{constructor(a,b){this.table=a,this.config=b}static [f.entityKind]="Relations"}class bA extends by{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [f.entityKind]="One";withFieldName(a){let b=new bA(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class bB extends by{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [f.entityKind]="Many";withFieldName(a){let b=new bB(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function bC(a){return{one:function(b,c){return new bA(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new bB(a,b,c)}}}var bD=a.i(55280);class bE{constructor(a){this.table=a}static [f.entityKind]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class bF{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [f.entityKind]="TableAliasProxyHandler";get(a,b){if(b===j.Table.Symbol.IsAlias)return!0;if(b===j.Table.Symbol.Name||this.replaceOriginalName&&b===j.Table.Symbol.OriginalName)return this.alias;if(b===bD.ViewBaseConfig)return{...a[bD.ViewBaseConfig],name:this.alias,isAlias:!0};if(b===j.Table.Symbol.Columns){let b=a[j.Table.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new bE(new Proxy(a,this)))}),c}let c=a[b];return(0,f.is)(c,k.Column)?new Proxy(c,new bE(new Proxy(a,this))):c}}class bG{constructor(a){this.alias=a}static [f.entityKind]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?bH(a.sourceTable,this.alias):a[b]}}function bH(a,b){return new Proxy(a,new bF(b,!1))}function bI(a,b){return new Proxy(a,new bE(new Proxy(a.table,new bF(b,!1))))}function bJ(a,b){return new M.SQL.Aliased(bK(a.sql,b),a.fieldAlias)}function bK(a,b){return M.sql.join(a.queryChunks.map(a=>(0,f.is)(a,k.Column)?bI(a,b):(0,f.is)(a,M.SQL)?bK(a,b):(0,f.is)(a,M.SQL.Aliased)?bJ(a,b):a))}var bL=a.i(4501);class bM{static [f.entityKind]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===bD.ViewBaseConfig)return{...a[bD.ViewBaseConfig],selectedFields:new Proxy(a[bD.ViewBaseConfig].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=((0,f.is)(a,bL.Subquery)?a._.selectedFields:(0,f.is)(a,M.View)?a[bD.ViewBaseConfig].selectedFields:a)[b];if((0,f.is)(c,M.SQL.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if((0,f.is)(c,M.SQL)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,f.is)(c,k.Column)?this.config.alias?new Proxy(c,new bE(new Proxy(c.table,new bF(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new bM(this.config))}}function bN(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function bO(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function bP(a){return a}class bQ{static [f.entityKind]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?bN:"camelCase"===a?bO:bP}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[j.Table.Symbol.Schema]??"public",c=a.table[j.Table.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[j.Table.Symbol.Schema]??"public",c=a[j.Table.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[j.Table.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class bR extends Error{static [f.entityKind]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class bS extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,bS),c&&(this.cause=c)}}class bT extends bR{static [f.entityKind]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}var bU=a.i(52149),bV=a.i(85880),bW=M;class bX extends bW.View{static [f.entityKind]="SQLiteViewBase"}class bY{static [f.entityKind]="SQLiteDialect";casing;constructor(a){this.casing=new bQ(a?.casing)}escapeName(a){return`"${a}"`}escapeParam(a){return"?"}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[M.sql`with `];for(let[c,d]of a.entries())b.push(M.sql`${M.sql.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push(M.sql`, `);return b.push(M.sql` `),M.sql.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d,limit:e,orderBy:f}){let g=this.buildWithCTE(d),h=c?M.sql` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,i=b?M.sql` where ${b}`:void 0,j=this.buildOrderBy(f),k=this.buildLimit(e);return M.sql`${g}delete from ${a}${i}${h}${j}${k}`}buildUpdateSet(a,b){let c=a[j.Table.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return M.sql.join(d.flatMap((a,d)=>{let g=c[a],h=g.onUpdateFn?.(),i=b[a]??((0,f.is)(h,M.SQL)?h:M.sql.param(h,g)),j=M.sql`${M.sql.identifier(this.casing.getColumnCasing(g))} = ${i}`;return d<e-1?[j,M.sql.raw(", ")]:[j]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,joins:f,from:g,limit:h,orderBy:i}){let j=this.buildWithCTE(e),k=this.buildUpdateSet(a,b),l=g&&M.sql.join([M.sql.raw(" from "),this.buildFromTable(g)]),m=this.buildJoins(f),n=d?M.sql` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,o=c?M.sql` where ${c}`:void 0,p=this.buildOrderBy(i),q=this.buildLimit(h);return M.sql`${j}update ${a} set ${k}${l}${m}${o}${n}${p}${q}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let e=[];if((0,f.is)(a,M.SQL.Aliased)&&a.isSelectionField)e.push(M.sql.identifier(a.fieldAlias));else if((0,f.is)(a,M.SQL.Aliased)||(0,f.is)(a,M.SQL)){let c=(0,f.is)(a,M.SQL.Aliased)?a.sql:a;b?e.push(new M.SQL(c.queryChunks.map(a=>(0,f.is)(a,k.Column)?M.sql.identifier(this.casing.getColumnCasing(a)):a))):e.push(c),(0,f.is)(a,M.SQL.Aliased)&&e.push(M.sql` as ${M.sql.identifier(a.fieldAlias)}`)}else if((0,f.is)(a,k.Column)){let c=a.table[j.Table.Symbol.Name];"SQLiteNumericBigInt"===a.columnType?b?e.push(M.sql`cast(${M.sql.identifier(this.casing.getColumnCasing(a))} as text)`):e.push(M.sql`cast(${M.sql.identifier(c)}.${M.sql.identifier(this.casing.getColumnCasing(a))} as text)`):b?e.push(M.sql.identifier(this.casing.getColumnCasing(a))):e.push(M.sql`${M.sql.identifier(c)}.${M.sql.identifier(this.casing.getColumnCasing(a))}`)}else if((0,f.is)(a,bL.Subquery)){let b=Object.entries(a._.selectedFields);if(1===b.length){let c=b[0][1],d=(0,f.is)(c,M.SQL)?c.decoder:(0,f.is)(c,k.Column)?{mapFromDriverValue:a=>c.mapFromDriverValue(a)}:c.sql.decoder;d&&(a._.sql.decoder=d)}e.push(a)}return d<c-1&&e.push(M.sql`, `),e});return M.sql.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];if(a)for(let[c,d]of a.entries()){0===c&&b.push(M.sql` `);let e=d.table,g=d.on?M.sql` on ${d.on}`:void 0;if((0,f.is)(e,bV.SQLiteTable)){let a=e[bV.SQLiteTable.Symbol.Name],c=e[bV.SQLiteTable.Symbol.Schema],f=e[bV.SQLiteTable.Symbol.OriginalName],h=a===f?void 0:d.alias;b.push(M.sql`${M.sql.raw(d.joinType)} join ${c?M.sql`${M.sql.identifier(c)}.`:void 0}${M.sql.identifier(f)}${h&&M.sql` ${M.sql.identifier(h)}`}${g}`)}else b.push(M.sql`${M.sql.raw(d.joinType)} join ${e}${g}`);c<a.length-1&&b.push(M.sql` `)}return M.sql.join(b)}buildLimit(a){return"object"==typeof a||"number"==typeof a&&a>=0?M.sql` limit ${a}`:void 0}buildOrderBy(a){let b=[];if(a)for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(M.sql`, `);return b.length>0?M.sql` order by ${M.sql.join(b)}`:void 0}buildFromTable(a){return(0,f.is)(a,j.Table)&&a[j.Table.Symbol.IsAlias]?M.sql`${M.sql`${M.sql.identifier(a[j.Table.Symbol.Schema]??"")}.`.if(a[j.Table.Symbol.Schema])}${M.sql.identifier(a[j.Table.Symbol.OriginalName])} ${M.sql.identifier(a[j.Table.Symbol.Name])}`:a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:e,table:g,joins:h,orderBy:i,groupBy:l,limit:n,offset:o,distinct:p,setOperators:q}){let r=c??(0,m.orderSelectedFields)(b);for(let a of r){let b;if((0,f.is)(a.field,k.Column)&&(0,j.getTableName)(a.field.table)!==((0,f.is)(g,bL.Subquery)?g._.alias:(0,f.is)(g,bX)?g[bD.ViewBaseConfig].name:(0,f.is)(g,M.SQL)?void 0:(0,j.getTableName)(g))&&(b=a.field.table,!h?.some(({alias:a})=>a===(b[j.Table.Symbol.IsAlias]?(0,j.getTableName)(b):b[j.Table.Symbol.BaseName])))){let b=(0,j.getTableName)(a.field.table);throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let s=!h||0===h.length,t=this.buildWithCTE(a),u=p?M.sql` distinct`:void 0,v=this.buildSelection(r,{isSingleTable:s}),w=this.buildFromTable(g),x=this.buildJoins(h),y=d?M.sql` where ${d}`:void 0,z=e?M.sql` having ${e}`:void 0,A=[];if(l)for(let[a,b]of l.entries())A.push(b),a<l.length-1&&A.push(M.sql`, `);let B=A.length>0?M.sql` group by ${M.sql.join(A)}`:void 0,C=this.buildOrderBy(i),D=this.buildLimit(n),E=o?M.sql` offset ${o}`:void 0,F=M.sql`${t}select${u} ${v} from ${w}${x}${y}${B}${z}${C}${D}${E}`;return q.length>0?this.buildSetOperations(F,q):F}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:e,orderBy:g,offset:h}}){let i,j=M.sql`${a.getSQL()} `,k=M.sql`${d.getSQL()}`;if(g&&g.length>0){let a=[];for(let b of g)if((0,f.is)(b,bU.SQLiteColumn))a.push(M.sql.identifier(b.name));else if((0,f.is)(b,M.SQL)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];(0,f.is)(c,bU.SQLiteColumn)&&(b.queryChunks[a]=M.sql.identifier(this.casing.getColumnCasing(c)))}a.push(M.sql`${b}`)}else a.push(M.sql`${b}`);i=M.sql` order by ${M.sql.join(a,M.sql`, `)}`}let l="object"==typeof e||"number"==typeof e&&e>=0?M.sql` limit ${e}`:void 0,m=M.sql.raw(`${b} ${c?"all ":""}`),n=h?M.sql` offset ${h}`:void 0;return M.sql`${j}${m}${k}${i}${l}${n}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:e,select:g}){let h=[],i=Object.entries(a[j.Table.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),k=i.map(([,a])=>M.sql.identifier(this.casing.getColumnCasing(a)));if(g)(0,f.is)(b,M.SQL)?h.push(b):h.push(b.getSQL());else for(let[a,c]of(h.push(M.sql.raw("values ")),b.entries())){let d=[];for(let[a,b]of i){let e=c[a];if(void 0===e||(0,f.is)(e,M.Param)&&void 0===e.value){let a;if(null!==b.default&&void 0!==b.default)a=(0,f.is)(b.default,M.SQL)?b.default:M.sql.param(b.default,b);else if(void 0!==b.defaultFn){let c=b.defaultFn();a=(0,f.is)(c,M.SQL)?c:M.sql.param(c,b)}else if(b.default||void 0===b.onUpdateFn)a=M.sql`null`;else{let c=b.onUpdateFn();a=(0,f.is)(c,M.SQL)?c:M.sql.param(c,b)}d.push(a)}else d.push(e)}h.push(d),a<b.length-1&&h.push(M.sql`, `)}let l=this.buildWithCTE(e),m=M.sql.join(h),n=d?M.sql` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,o=c?.length?M.sql.join(c):void 0;return M.sql`${l}insert into ${a} ${k} ${m}${o}${n}`}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:b})}buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:e,queryConfig:g,tableAlias:h,nestedQueryRelation:i,joinOn:l}){let m,n=[],o,p,q=[],r,s=[];if(!0===g)n=Object.entries(e.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:bI(b,h),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(e.columns).map(([a,b])=>[a,bI(b,h)]));if(g.where){let a="function"==typeof g.where?g.where(d,{and:bv.and,between:bv.between,eq:bv.eq,exists:bv.exists,gt:bv.gt,gte:bv.gte,ilike:bv.ilike,inArray:bv.inArray,isNull:bv.isNull,isNotNull:bv.isNotNull,like:bv.like,lt:bv.lt,lte:bv.lte,ne:bv.ne,not:bv.not,notBetween:bv.notBetween,notExists:bv.notExists,notLike:bv.notLike,notIlike:bv.notIlike,notInArray:bv.notInArray,or:bv.or,sql:M.sql}):g.where;r=a&&bK(a,h)}let i=[],l=[];if(g.columns){let a=!1;for(let[b,c]of Object.entries(g.columns))void 0!==c&&b in e.columns&&(a||!0!==c||(a=!0),l.push(b));l.length>0&&(l=a?l.filter(a=>g.columns?.[a]===!0):Object.keys(e.columns).filter(a=>!l.includes(a)))}else l=Object.keys(e.columns);for(let a of l){let b=e.columns[a];i.push({tsKey:a,value:b})}let m=[];if(g.with&&(m=Object.entries(g.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:e.relations[a]}))),g.extras)for(let[a,b]of Object.entries("function"==typeof g.extras?g.extras(d,{sql:M.sql}):g.extras))i.push({tsKey:a,value:bJ(b,h)});for(let{tsKey:a,value:b}of i)n.push({dbKey:(0,f.is)(b,M.SQL.Aliased)?b.fieldAlias:e.columns[a].name,tsKey:a,field:(0,f.is)(b,k.Column)?bI(b,h):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let s="function"==typeof g.orderBy?g.orderBy(d,{sql:M.sql,asc:bw,desc:bx}):g.orderBy??[];for(let{tsKey:d,queryConfig:e,relation:i}of(Array.isArray(s)||(s=[s]),q=s.map(a=>(0,f.is)(a,k.Column)?bI(a,h):bK(a,h)),o=g.limit,p=g.offset,m)){let g=function(a,b,c){if((0,f.is)(c,bA)&&c.config)return{fields:c.config.fields,references:c.config.references};let d=b[(0,j.getTableUniqueName)(c.referencedTable)];if(!d)throw Error(`Table "${c.referencedTable[j.Table.Symbol.Name]}" not found in schema`);let e=a[d];if(!e)throw Error(`Table "${d}" not found in schema`);let g=c.sourceTable,h=b[(0,j.getTableUniqueName)(g)];if(!h)throw Error(`Table "${g[j.Table.Symbol.Name]}" not found in schema`);let i=[];for(let a of Object.values(e.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&i.push(a);if(i.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${d}"`):Error(`There are multiple relations between "${d}" and "${c.sourceTable[j.Table.Symbol.Name]}". Please specify relation name`);if(i[0]&&(0,f.is)(i[0],bA)&&i[0].config)return{fields:i[0].config.references,references:i[0].config.fields};throw Error(`There is not enough information to infer relation "${h}.${c.fieldName}"`)}(b,c,i),k=c[(0,j.getTableUniqueName)(i.referencedTable)],l=`${h}_${d}`,m=(0,bv.and)(...g.fields.map((a,b)=>(0,bv.eq)(bI(g.references[b],l),bI(a,h)))),o=this.buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:a[k],tableConfig:b[k],queryConfig:(0,f.is)(i,bA)?!0===e?{limit:1}:{...e,limit:1}:e,tableAlias:l,joinOn:m,nestedQueryRelation:i}),p=M.sql`(${o.sql})`.as(d);n.push({dbKey:d,tsKey:d,field:p,relationTableTsKey:k,isJson:!0,selection:o.selection})}}if(0===n.length)throw new bR({message:`No fields selected for table "${e.tsName}" ("${h}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(r=(0,bv.and)(l,r),i){let a=M.sql`json_array(${M.sql.join(n.map(({field:a})=>(0,f.is)(a,bU.SQLiteColumn)?M.sql.identifier(this.casing.getColumnCasing(a)):(0,f.is)(a,M.SQL.Aliased)?a.sql:a),M.sql`, `)})`;(0,f.is)(i,bB)&&(a=M.sql`coalesce(json_group_array(${a}), json_array())`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:e.tsName,selection:n}];void 0!==o||void 0!==p||q.length>0?(m=this.buildSelectQuery({table:bH(d,h),fields:{},fieldsFlat:[{path:[],field:M.sql.raw("*")}],where:r,limit:o,offset:p,orderBy:q,setOperators:[]}),r=void 0,o=void 0,p=void 0,q=void 0):m=bH(d,h),m=this.buildSelectQuery({table:(0,f.is)(m,bV.SQLiteTable)?m:new bL.Subquery(m,{},h),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:(0,f.is)(a,k.Column)?bI(a,h):a})),joins:s,where:r,limit:o,offset:p,orderBy:q,setOperators:[]})}else m=this.buildSelectQuery({table:bH(d,h),fields:{},fieldsFlat:n.map(({field:a})=>({path:[],field:(0,f.is)(a,k.Column)?bI(a,h):a})),joins:s,where:r,limit:o,offset:p,orderBy:q,setOperators:[]});return{tableTsKey:e.tsName,sql:m,selection:n}}}class bZ extends bY{static [f.entityKind]="SQLiteSyncDialect";migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=M.sql`
			CREATE TABLE IF NOT EXISTS ${M.sql.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;b.run(e);let f=b.values(M.sql`SELECT id, hash, created_at FROM ${M.sql.identifier(d)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;b.run(M.sql`BEGIN`);try{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)b.run(M.sql.raw(a));b.run(M.sql`INSERT INTO ${M.sql.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}b.run(M.sql`COMMIT`)}catch(a){throw b.run(M.sql`ROLLBACK`),a}}}class b$ extends bY{static [f.entityKind]="SQLiteAsyncDialect";async migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=M.sql`
			CREATE TABLE IF NOT EXISTS ${M.sql.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await b.run(e);let f=(await b.values(M.sql`SELECT id, hash, created_at FROM ${M.sql.identifier(d)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await b.transaction(async b=>{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)await b.run(M.sql.raw(a));await b.run(M.sql`INSERT INTO ${M.sql.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}})}}class b_{static [f.entityKind]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class b0{static [f.entityKind]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}class b1{constructor(a,b){this.name=a,this.value=b}static [f.entityKind]="SQLiteCheckBuilder";brand;build(a){return new b2(a,this)}}class b2{constructor(a,b){this.table=a,this.name=b.name,this.value=b.value}static [f.entityKind]="SQLiteCheck";name;value}a.i(59547);class b3{constructor(a,b){this.name=a,this.unique=b}static [f.entityKind]="SQLiteIndexBuilderOn";on(...a){return new b4(this.name,a,this.unique)}}class b4{static [f.entityKind]="SQLiteIndexBuilder";config;constructor(a,b,c){this.config={name:a,columns:b,unique:c,where:void 0}}where(a){return this.config.where=a,this}build(a){return new b5(this.config,a)}}class b5{static [f.entityKind]="SQLiteIndex";config;constructor(a,b){this.config={...a,table:b}}}class b6{static [f.entityKind]="SQLitePrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new b7(a,this.columns,this.name)}}class b7{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [f.entityKind]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[bV.SQLiteTable.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}function b8(a){return(0,f.is)(a,bV.SQLiteTable)?[`${a[j.Table.Symbol.BaseName]}`]:(0,f.is)(a,bL.Subquery)?a._.usedTables??[]:(0,f.is)(a,M.SQL)?a.usedTables??[]:[]}a.i(69565);class b9{static [f.entityKind]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,this.withList=a.withList,this.distinct=a.distinct}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:(0,f.is)(a,bL.Subquery)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):(0,f.is)(a,bX)?a[bD.ViewBaseConfig].selectedFields:(0,f.is)(a,M.SQL)?{}:(0,m.getTableColumns)(a),new cb({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class ca extends b_{static [f.entityKind]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(const h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=(0,m.getTableLikeName)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},b8(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a){return(b,c)=>{let d=this.tableName,e=(0,m.getTableLikeName)(b);for(let a of b8(b))this.usedTables.add(a);if("string"==typeof e&&this.config.joins?.some(a=>a.alias===e))throw Error(`Alias "${e}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof d&&(this.config.fields={[d]:this.config.fields}),"string"==typeof e&&!(0,f.is)(b,M.SQL))){let a=(0,f.is)(b,bL.Subquery)?b._.selectedFields:(0,f.is)(b,M.View)?b[bD.ViewBaseConfig].selectedFields:b[j.Table.Symbol.Columns];this.config.fields[e]=a}if("function"==typeof c&&(c=c(new Proxy(this.config.fields,new bM({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:c,table:b,joinType:a,alias:e}),"string"==typeof e)switch(a){case"left":this.joinsNotNullableMap[e]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[e]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(a,b){return c=>{let d="function"==typeof c?c(cd()):c;if(!(0,m.haveSameKeys)(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new bM({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new bM({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new bM({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new bM({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...b8(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...b8(a.table));return new Proxy(new bL.Subquery(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new bM({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new bM({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class cb extends ca{static [f.entityKind]="SQLiteSelect";_prepare(a=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let b=(0,m.orderSelectedFields)(this.config.fields),c=this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),b,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return c.joinsNotNullableMap=this.joinsNotNullableMap,c}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.all()}}function cc(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!(0,m.haveSameKeys)(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}(0,m.applyMixins)(cb,[b0]);let cd=()=>({union:ce,unionAll:cf,intersect:cg,except:ch}),ce=cc("union",!1),cf=cc("union",!0),cg=cc("intersect",!1),ch=cc("except",!1);class ci{static [f.entityKind]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=(0,f.is)(a,bY)?a:void 0,this.dialectConfig=(0,f.is)(a,bY)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new bL.WithSubquery(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new bM({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new b9({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(c){return new b9({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a,distinct:!0})}}}select(a){return new b9({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new b9({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new bZ(this.dialectConfig)),this.dialect}}class cj extends b0{constructor(a,b,c,d){super(),this.table=a,this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [f.entityKind]="SQLiteDelete";config;where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[j.Table.Symbol.Columns],new bM({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.table[bV.SQLiteTable.Symbol.Columns]){return this.config.returning=(0,m.orderSelectedFields)(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:b8(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(a){return this._prepare().execute(a)}$dynamic(){return this}}class ck{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [f.entityKind]="SQLiteInsertBuilder";values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[j.Table.Symbol.Columns];for(let d of Object.keys(a)){let e=a[d];b[d]=(0,f.is)(e,M.SQL)?e:new M.Param(e,c[d])}return b});return new cl(this.table,b,this.session,this.dialect,this.withList)}select(a){let b="function"==typeof a?a(new ci):a;if(!(0,f.is)(b,M.SQL)&&!(0,m.haveSameKeys)(this.table[j.Columns],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,b,this.session,this.dialect,this.withList,!0)}}class cl extends b0{constructor(a,b,c,d,e,f){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f}}static [f.entityKind]="SQLiteInsert";config;returning(a=this.config.table[bV.SQLiteTable.Symbol.Columns]){return this.config.returning=(0,m.orderSelectedFields)(a),this}onConflictDoNothing(a={}){if(this.config.onConflict||(this.config.onConflict=[]),void 0===a.target)this.config.onConflict.push(M.sql` on conflict do nothing`);else{let b=Array.isArray(a.target)?M.sql`${a.target}`:M.sql`${[a.target]}`,c=a.where?M.sql` where ${a.where}`:M.sql``;this.config.onConflict.push(M.sql` on conflict ${b} do nothing${c}`)}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let b=a.where?M.sql` where ${a.where}`:void 0,c=a.targetWhere?M.sql` where ${a.targetWhere}`:void 0,d=a.setWhere?M.sql` where ${a.setWhere}`:void 0,e=Array.isArray(a.target)?M.sql`${a.target}`:M.sql`${[a.target]}`,f=this.dialect.buildUpdateSet(this.config.table,(0,m.mapUpdateSet)(this.config.table,a.set));return this.config.onConflict.push(M.sql` on conflict ${e}${c} do update set ${f}${b}${d}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:b8(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class cm{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [f.entityKind]="SQLiteUpdateBuilder";set(a){return new cn(this.table,(0,m.mapUpdateSet)(this.table,a),this.session,this.dialect,this.withList)}}class cn extends b0{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]}}static [f.entityKind]="SQLiteUpdate";config;from(a){return this.config.from=a,this}createJoin(a){return(b,c)=>{let d=(0,m.getTableLikeName)(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from?(0,f.is)(b,bV.SQLiteTable)?b[j.Table.Symbol.Columns]:(0,f.is)(b,bL.Subquery)?b._.selectedFields:(0,f.is)(b,bX)?b[bD.ViewBaseConfig].selectedFields:void 0:void 0;c=c(new Proxy(this.config.table[j.Table.Symbol.Columns],new bM({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new bM({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:c,table:b,joinType:a,alias:d}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[j.Table.Symbol.Columns],new bM({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.config.table[bV.SQLiteTable.Symbol.Columns]){return this.config.returning=(0,m.orderSelectedFields)(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:b8(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}var co=M;class cp extends co.SQL{constructor(a){super(cp.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.session=a.session,this.sql=cp.buildCount(a.source,a.filters)}sql;static [f.entityKind]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(a,b){return co.sql`(select count(*) from ${a}${co.sql.raw(" where ").if(b)}${b})`}static buildCount(a,b){return co.sql`select count(*) from ${a}${co.sql.raw(" where ").if(b)}${b}`}then(a,b){return Promise.resolve(this.session.count(this.sql)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class cq{constructor(a,b,c,d,e,f,g,h){this.mode=a,this.fullSchema=b,this.schema=c,this.tableNamesMap=d,this.table=e,this.tableConfig=f,this.dialect=g,this.session=h}static [f.entityKind]="SQLiteAsyncRelationalQueryBuilder";findMany(a){return"sync"===this.mode?new cs(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many"):new cr(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return"sync"===this.mode?new cs(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first"):new cr(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class cr extends b0{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [f.entityKind]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(a=!1){let{query:b,builtQuery:c}=this._toSQL();return this.session[a?"prepareOneTimeQuery":"prepareQuery"](c,void 0,"first"===this.mode?"get":"all",!0,(a,c)=>{let d=a.map(a=>(function a(b,c,d,e,g=a=>a){let h={};for(let[i,j]of e.entries())if(j.isJson){let e=c.relations[j.tsKey],k=d[i],l="string"==typeof k?JSON.parse(k):k;h[j.tsKey]=(0,f.is)(e,bA)?l&&a(b,b[j.relationTableTsKey],l,j.selection,g):l.map(c=>a(b,b[j.relationTableTsKey],c,j.selection,g))}else{let a,b=g(d[i]),c=j.field;a=(0,f.is)(c,k.Column)?c:(0,f.is)(c,M.SQL)?c.decoder:c.sql.decoder,h[j.tsKey]=null===b?null:a.mapFromDriverValue(b)}return h})(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})}prepare(){return this._prepare(!1)}_toSQL(){let a=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class cs extends cr{static [f.entityKind]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class ct extends b0{constructor(a,b,c,d,e){super(),this.execute=a,this.getSQL=b,this.dialect=d,this.mapBatchResult=e,this.config={action:c}}static [f.entityKind]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class cu{constructor(a,b,c,d){this.resultKind=a,this.dialect=b,this.session=c,this._=d?{schema:d.schema,fullSchema:d.fullSchema,tableNamesMap:d.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};const e=this.query;if(this._.schema)for(const[f,g]of Object.entries(this._.schema))e[f]=new cq(a,d.fullSchema,this._.schema,this._.tableNamesMap,d.fullSchema[f],g,b,c);this.$cache={invalidate:async a=>{}}}static [f.entityKind]="BaseSQLiteDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new ci(c.dialect))),new Proxy(new bL.WithSubquery(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new bM({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new cp({source:a,filters:b,session:this.session})}with(...a){let b=this;return{select:function(c){return new b9({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new b9({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},update:function(c){return new cm(c,b.session,b.dialect,a)},insert:function(c){return new ck(c,b.session,b.dialect,a)},delete:function(c){return new cj(c,b.session,b.dialect,a)}}}select(a){return new b9({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new b9({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(a){return new cm(a,this.session,this.dialect)}$cache;insert(a){return new ck(a,this.session,this.dialect)}delete(a){return new cj(a,this.session,this.dialect)}run(a){let b="string"==typeof a?M.sql.raw(a):a.getSQL();return"async"===this.resultKind?new ct(async()=>this.session.run(b),()=>b,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(b)}all(a){let b="string"==typeof a?M.sql.raw(a):a.getSQL();return"async"===this.resultKind?new ct(async()=>this.session.all(b),()=>b,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(b)}get(a){let b="string"==typeof a?M.sql.raw(a):a.getSQL();return"async"===this.resultKind?new ct(async()=>this.session.get(b),()=>b,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(b)}values(a){let b="string"==typeof a?M.sql.raw(a):a.getSQL();return"async"===this.resultKind?new ct(async()=>this.session.values(b),()=>b,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(b)}transaction(a,b){return this.session.transaction(a,b)}}class cv{static [f.entityKind]="Cache"}class cw extends cv{strategy(){return"all"}static [f.entityKind]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function cx(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class cy extends b0{constructor(a){super(),this.resultCb=a}static [f.entityKind]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class cz{constructor(a,b,c,d,e,f){this.mode=a,this.executeMethod=b,this.query=c,this.cache=d,this.queryMetadata=e,this.cacheConfig=f,d&&"all"===d.strategy()&&void 0===f&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}static [f.entityKind]="PreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||(0,f.is)(this.cache,cw)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new bS(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new bS(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new bS(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await cx(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new bS(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await cx(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new bS(a,b,c)}}getQuery(){return this.query}mapRunResult(a,b){return a}mapAllResult(a,b){throw Error("Not implemented")}mapGetResult(a,b){throw Error("Not implemented")}execute(a){return"async"===this.mode?this[this.executeMethod](a):new cy(()=>this[this.executeMethod](a))}mapResult(a,b){switch(this.executeMethod){case"run":return this.mapRunResult(a,b);case"all":return this.mapAllResult(a,b);case"get":return this.mapGetResult(a,b)}}}class cA{constructor(a){this.dialect=a}static [f.entityKind]="SQLiteSession";prepareOneTimeQuery(a,b,c,d,e,f,g){return this.prepareQuery(a,b,c,d,e,f,g)}run(a){let b=this.dialect.sqlToQuery(a);try{return this.prepareOneTimeQuery(b,void 0,"run",!1).run()}catch(a){throw new bR({cause:a,message:`Failed to run the query '${b.sql}'`})}}extractRawRunValueFromBatchResult(a){return a}all(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(a){throw Error("Not implemented")}get(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(a){throw Error("Not implemented")}values(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).values()}async count(a){return(await this.values(a))[0][0]}extractRawValuesValueFromBatchResult(a){throw Error("Not implemented")}}class cB extends cu{constructor(a,b,c,d,e=0){super(a,b,c,d),this.schema=d,this.nestedIndex=e}static [f.entityKind]="SQLiteTransaction";rollback(){throw new bT}}class cC extends cA{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new i,this.cache=d.cache??new cw}static [f.entityKind]="SQLiteD1Session";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new cF(this.client.prepare(a.sql),a,this.logger,this.cache,f,g,b,c,d,e)}async batch(a){let b=[],c=[];for(let d of a){let a=d._prepare(),e=a.getQuery();if(b.push(a),e.params.length>0)c.push(a.stmt.bind(...e.params));else{let b=a.getQuery();c.push(this.client.prepare(b.sql).bind(...b.params))}}return(await this.client.batch(c)).map((a,c)=>b[c].mapResult(a,!0))}extractRawAllValueFromBatchResult(a){return a.results}extractRawGetValueFromBatchResult(a){return a.results[0]}extractRawValuesValueFromBatchResult(a){return cE(a.results)}async transaction(a,b){let c=new cD("async",this.dialect,this,this.schema);await this.run(M.sql.raw(`begin${b?.behavior?" "+b.behavior:""}`));try{let b=await a(c);return await this.run(M.sql`commit`),b}catch(a){throw await this.run(M.sql`rollback`),a}}}class cD extends cB{static [f.entityKind]="D1Transaction";async transaction(a){let b=`sp${this.nestedIndex}`,c=new cD("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(M.sql.raw(`savepoint ${b}`));try{let d=await a(c);return await this.session.run(M.sql.raw(`release savepoint ${b}`)),d}catch(a){throw await this.session.run(M.sql.raw(`rollback to savepoint ${b}`)),a}}}function cE(a){let b=[];for(let c of a){let a=Object.keys(c).map(a=>c[a]);b.push(a)}return b}class cF extends cz{constructor(a,b,c,d,e,f,g,h,i,j){super("async",h,b,d,e,f),this.logger=c,this._isResponseInArrayMode=i,this.customResultMapper=j,this.fields=g,this.stmt=a}static [f.entityKind]="D1PreparedQuery";customResultMapper;fields;stmt;async run(a){let b=(0,M.fillPlaceholders)(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).run())}async all(a){let{fields:b,query:c,logger:d,stmt:e,customResultMapper:f}=this;if(!b&&!f){let b=(0,M.fillPlaceholders)(c.params,a??{});return d.logQuery(c.sql,b),await this.queryWithCache(c.sql,b,async()=>e.bind(...b).all().then(({results:a})=>this.mapAllResult(a)))}let g=await this.values(a);return this.mapAllResult(g)}mapAllResult(a,b){return(b&&(a=cE(a.results)),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper(a):a.map(a=>(0,m.mapResultRow)(this.fields,a,this.joinsNotNullableMap)):a}async get(a){let{fields:b,joinsNotNullableMap:c,query:d,logger:e,stmt:f,customResultMapper:g}=this;if(!b&&!g){let b=(0,M.fillPlaceholders)(d.params,a??{});return e.logQuery(d.sql,b),await this.queryWithCache(d.sql,b,async()=>f.bind(...b).all().then(({results:a})=>a[0]))}let h=await this.values(a);if(h[0])return g?g(h):(0,m.mapResultRow)(b,h[0],c)}mapGetResult(a,b){return(b&&(a=cE(a.results)[0]),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper([a]):(0,m.mapResultRow)(this.fields,a,this.joinsNotNullableMap):a}async values(a){let b=(0,M.fillPlaceholders)(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).raw())}isResponseInArrayMode(){return this._isResponseInArrayMode}}class cG extends cu{static [f.entityKind]="D1Database";async batch(a){return this.session.batch(a)}}var cH=a.i(3413),cI=a.i(33625),cJ=a.i(31333);let cK=(0,bV.sqliteTable)("products",{id:(0,cH.text)("id").primaryKey(),name:(0,cH.text)("name").notNull(),slug:(0,cH.text)("slug").notNull().unique(),description:(0,cH.text)("description").notNull(),price:(0,cI.integer)("price").notNull(),oldPrice:(0,cI.integer)("old_price"),stockQuantity:(0,cI.integer)("stock_quantity").notNull().default(0),inStock:(0,cI.integer)("in_stock",{mode:"boolean"}).notNull().default(!0),flowerType:(0,cH.text)("flower_type").notNull(),productImage:(0,cH.text)("product_image").notNull(),averageRating:(0,cJ.real)("average_rating").default(0),totalReviews:(0,cI.integer)("total_reviews").default(0),isFeatured:(0,cI.integer)("is_featured",{mode:"boolean"}).default(!1),isActive:(0,cI.integer)("is_active",{mode:"boolean"}).notNull().default(!0),createdAt:(0,cI.integer)("created_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))}),cL=(0,bV.sqliteTable)("occasions",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),name:(0,cH.text)("name").notNull(),slug:(0,cH.text)("slug").notNull().unique()}),cM=(0,bV.sqliteTable)("colors",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),name:(0,cH.text)("name").notNull(),slug:(0,cH.text)("slug").notNull().unique(),hexCode:(0,cH.text)("hex_code")}),cN=(0,bV.sqliteTable)("product_occasions",{productId:(0,cH.text)("product_id").notNull().references(()=>cK.id,{onDelete:"cascade"}),occasionId:(0,cI.integer)("occasion_id").notNull().references(()=>cL.id,{onDelete:"cascade"})}),cO=(0,bV.sqliteTable)("product_colors",{productId:(0,cH.text)("product_id").notNull().references(()=>cK.id,{onDelete:"cascade"}),colorId:(0,cI.integer)("color_id").notNull().references(()=>cM.id,{onDelete:"cascade"})}),cP=(0,bV.sqliteTable)("reviews",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),productId:(0,cH.text)("product_id").notNull().references(()=>cK.id,{onDelete:"cascade"}),userId:(0,cI.integer)("user_id").notNull(),rating:(0,cI.integer)("rating").notNull(),comment:(0,cH.text)("comment"),status:(0,cH.text)("status").notNull().default("pending"),createdAt:(0,cI.integer)("created_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))});a.s(["colors",0,cM,"occasions",0,cL,"productColors",0,cO,"productOccasions",0,cN,"products",0,cK,"reviews",0,cP],37137);var cQ=a.i(37137);let cR=(0,bV.sqliteTable)("users",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),name:(0,cH.text)("name").notNull(),email:(0,cH.text)("email").notNull().unique(),password:(0,cH.text)("password").notNull(),phone:(0,cH.text)("phone"),createdAt:(0,cI.integer)("created_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))}),cS=(0,bV.sqliteTable)("sessions",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),userId:(0,cI.integer)("user_id").notNull().references(()=>cR.id,{onDelete:"cascade"}),token:(0,cH.text)("token").notNull().unique(),expiresAt:(0,cI.integer)("expires_at").notNull(),createdAt:(0,cI.integer)("created_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))});a.s(["sessions",0,cS,"users",0,cR],60340);var cT=a.i(60340);let cU=(0,bV.sqliteTable)("cart",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),userId:(0,cI.integer)("user_id").notNull().references(()=>cR.id,{onDelete:"cascade"}),createdAt:(0,cI.integer)("created_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))}),cV=(0,bV.sqliteTable)("cart_items",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),cartId:(0,cI.integer)("cart_id").notNull().references(()=>cU.id,{onDelete:"cascade"}),productId:(0,cH.text)("product_id").notNull().references(()=>cK.id,{onDelete:"cascade"}),quantity:(0,cI.integer)("quantity").notNull().default(1),price:(0,cI.integer)("price").notNull()}),cW=(0,bV.sqliteTable)("wishlist",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),userId:(0,cI.integer)("user_id").notNull().references(()=>cR.id,{onDelete:"cascade"}),productId:(0,cH.text)("product_id").notNull().references(()=>cK.id,{onDelete:"cascade"}),addedAt:(0,cI.integer)("added_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))}),cX=(0,bV.sqliteTable)("orders",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),userId:(0,cI.integer)("user_id").notNull().references(()=>cR.id,{onDelete:"cascade"}),orderNumber:(0,cH.text)("order_number").notNull().unique(),subtotal:(0,cI.integer)("subtotal").notNull(),shippingCost:(0,cI.integer)("shipping_cost").notNull().default(0),totalAmount:(0,cI.integer)("total_amount").notNull(),paymentStatus:(0,cH.text)("payment_status").notNull().default("pending"),orderStatus:(0,cH.text)("order_status").notNull().default("processing"),deliveryType:(0,cH.text)("delivery_type").notNull().default("delivery"),deliveryAddress:(0,cH.text)("delivery_address"),transactionId:(0,cH.text)("transaction_id"),createdAt:(0,cI.integer)("created_at").notNull().$defaultFn(()=>Math.floor(Date.now()/1e3))}),cY=(0,bV.sqliteTable)("order_items",{id:(0,cI.integer)("id").primaryKey({autoIncrement:!0}),orderId:(0,cI.integer)("order_id").notNull().references(()=>cX.id,{onDelete:"cascade"}),productId:(0,cH.text)("product_id").notNull().references(()=>cK.id,{onDelete:"cascade"}),quantity:(0,cI.integer)("quantity").notNull(),price:(0,cI.integer)("price").notNull()});a.s(["cart",0,cU,"cartItems",0,cV,"orderItems",0,cY,"orders",0,cX,"wishlist",0,cW],45802);var cZ=a.i(45802),c$=a.i(64966);let c_={...cQ,...cT,...cZ,...c$};async function c0(){let{env:a}=await function(a={async:!1}){return a.async?d():function(){let a,b=c();if(b)return b;if(a=globalThis,a.__NEXT_DATA__?.nextExport===!0)throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error('\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n')}()}({async:!0});return function(a,b={}){let c,d,e=new b$({casing:b.casing});if(!0===b.logger?c=new h:!1!==b.logger&&(c=b.logger),b.schema){let a=function(a,b){1===Object.keys(a).length&&"default"in a&&!(0,f.is)(a.default,j.Table)&&(a=a.default);let c={},d={},e={};for(let[g,h]of Object.entries(a))if((0,f.is)(h,j.Table)){let a=(0,j.getTableUniqueName)(h),b=d[a];for(let d of(c[a]=g,e[g]={tsName:g,dbName:h[j.Table.Symbol.Name],schema:h[j.Table.Symbol.Schema],columns:h[j.Table.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(h[j.Table.Symbol.Columns])))d.primary&&e[g].primaryKey.push(d);let i=h[j.Table.Symbol.ExtraConfigBuilder]?.(h[j.Table.Symbol.ExtraConfigColumns]);if(i)for(let a of Object.values(i))(0,f.is)(a,bt)&&e[g].primaryKey.push(...a.columns)}else if((0,f.is)(h,bz)){let a,f=(0,j.getTableUniqueName)(h.table),g=c[f];for(let[c,i]of Object.entries(h.config(b(h.table))))if(g){let b=e[g];b.relations[c]=i,a&&b.primaryKey.push(...a)}else f in d||(d[f]={relations:{},primaryKey:a}),d[f].relations[c]=i}return{tables:e,tableNamesMap:c}}(b.schema,bC);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let g=new cC(a,e,d,{logger:c,cache:b.cache}),i=new cG("async",e,g,d);return i.$client=a,i.$cache=b.cache,i.$cache&&(i.$cache.invalidate=b.cache?.onMutate),i}(a.DB,{schema:c_})}a.s(["getDb",()=>c0],88041)}];

//# sourceMappingURL=src_lib_get-db_ts_d222b03e._.js.map